<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#375EAB">

  <title>websocketserver - The Go Programming Language</title>

<link type="text/css" rel="stylesheet" href="../lib/godoc/style.css">

<link rel="stylesheet" href="../lib/godoc/jquery.treeview.css">
<script>window.initFuncs = [];</script>
<script src="../lib/godoc/jquery.js" defer></script>
<script src="../lib/godoc/jquery.treeview.js" defer></script>
<script src="../lib/godoc/jquery.treeview.edit.js" defer></script>


<script>var goVersion = "go1.10.1";</script>
<script src="../lib/godoc/godocs.js" defer></script>
</head>
<body>

<div id='lowframe' style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
...
</div><!-- #lowframe -->

<div id="topbar" class="wide"><div class="container">
<div class="top-heading" id="heading-wide"><a href="#">The Go Programming Language</a></div>
<div class="top-heading" id="heading-narrow"><a href="#">Go</a></div>
<a href="index.html?m=all#" id="menu-button"><span id="menu-button-arrow">&#9661;</span></a>
<form method="GET" action="#">
<div id="menu">
<a href="#">Documents</a>
<a href="#">Packages</a>
<a href="#">The Project</a>
<a href="#">Help</a>

<a href="#">Blog</a>


<span class="search-box"><input type="search" id="search" name="q" placeholder="Search" aria-label="Search" required><button type="submit"><span><!-- magnifying glass: --><svg width="24" height="24" viewBox="0 0 24 24"><title>submit search</title><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M0 0h24v24H0z" fill="none"/></svg></span></button></span>
</div>
</form>

</div></div>



<div id="page" class="wide">
<div class="container">


  <h1>
    Package websocketserver
    <span class="text-muted"></span>
  </h1>







<div id="nav"></div>


<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->

	<script type='text/javascript'>
	document.ANALYSIS_DATA = null;
	document.CALLGRAPH = null;
	</script>

	
		
		<div id="short-nav">
			<dl>
			<dd><code>import "github.com/cyborg-client/Remap-server/websocketserver"</code></dd>
			</dl>
			<dl>
			<dd><a href="index.html?m=all#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="index.html?m=all#pkg-index" class="indexLink">Index</a></dd>
			
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>
Package websocketserver implements the WebSocket connection for serving data to users.
</p>

				
			</div>
		</div>

		<div id="pkg-index" class="toggleVisible">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Index section">Index ▹</h2>
		</div>
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Index section">Index ▾</h2>

		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
			<div id="manual-nav">
			<dl>
			
			
			
				
				<dd><a href="index.html?m=all#Main">func Main(parsedDataCh &lt;-chan []int64)</a></dd>
			
				
				<dd><a href="index.html?m=all#clientHandler">func clientHandler(ws *websocket.Conn, everyMs int64, dataCh &lt;-chan []int64)</a></dd>
			
				
				<dd><a href="index.html?m=all#sendAndResetBucket">func sendAndResetBucket(bucket *[]int64, ws *websocket.Conn, timeNow *int64)</a></dd>
			
				
				<dd><a href="index.html?m=all#serverMain">func serverMain(registerNewClientCh chan&lt;- splitterRequest, deleteClientCh chan&lt;- splitterRequest)</a></dd>
			
				
				<dd><a href="index.html?m=all#splitterMain">func splitterMain(timestampdataCh &lt;-chan []int64, registerNewClientCh &lt;-chan splitterRequest, deleteClientCh &lt;-chan splitterRequest)</a></dd>
			
				
				<dd><a href="index.html?m=all#stimulateServer">func stimulateServer(rw http.ResponseWriter, req *http.Request)</a></dd>
			
			
				
				<dd><a href="index.html?m=all#splitterRequest">type splitterRequest</a></dd>
				
				
			
				
				<dd><a href="index.html?m=all#stimulateRequest">type stimulateRequest</a></dd>
				
				
			
			
			</dl>
			</div><!-- #manual-nav -->

		

		
			<h3>Package files</h3>
			<p>
			<span style="font-size:90%">
			
				<a href="#">datatypes.go</a>
			
				<a href="#">server.go</a>
			
				<a href="#">splitter.go</a>
			
				<a href="#">stimulateserver.go</a>
			
			</span>
			</p>
		
		</div><!-- .expanded -->
		</div><!-- #pkg-index -->

		<div id="pkg-callgraph" class="toggle" style="display: none">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Internal Call Graph section">Internal call graph ▹</h2>
		</div> <!-- .expanded -->
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Internal Call Graph section">Internal call graph ▾</h2>
			<p>
			  In the call graph viewer below, each node
			  is a function belonging to this package
			  and its children are the functions it
			  calls&mdash;perhaps dynamically.
			</p>
			<p>
			  The root nodes are the entry points of the
			  package: functions that may be called from
			  outside the package.
			  There may be non-exported or anonymous
			  functions among them if they are called
			  dynamically from another package.
			</p>
			<p>
			  Click a node to visit that function's source code.
			  From there you can visit its callers by
			  clicking its declaring <code>func</code>
			  token.
			</p>
			<p>
			  Functions may be omitted if they were
			  determined to be unreachable in the
			  particular programs or tests that were
			  analyzed.
			</p>
			<!-- Zero means show all package entry points. -->
			<ul style="margin-left: 0.5in" id="callgraph-0" class="treeview"></ul>
		</div>
		</div> <!-- #pkg-callgraph -->

		
		
		
			
			
			<h2 id="Main">func <a href="#">Main</a>
				<a class="permalink" href="index.html?m=all#Main">&#xb6;</a>
			</h2>
			<pre>func Main(parsedDataCh &lt;-chan []<a href="#">int64</a>)</pre>
			<p>
Main is the entry point for the websocketserver. Requires timestampdataCh, which expects parsed data from the analysis package.
</p>

			
			

		
			
			
			<h2 id="clientHandler">func <a href="#">clientHandler</a>
				<a class="permalink" href="index.html?m=all#clientHandler">&#xb6;</a>
			</h2>
			<pre>func clientHandler(ws *<a href="#">websocket</a>.<a href="#n">Conn</a>, everyMs <a href="#">int64</a>, dataCh &lt;-chan []<a href="#">int64</a>)</pre>
			<p>
clientHandler handles a websocket connection. It processes the timestampdata from the analysis module,
and puts them into their respective 60 buckets. When everyMs has passed, it calls the sendAndResetBucket function
</p>

			
			

		
			
			
			<h2 id="sendAndResetBucket">func <a href="#">sendAndResetBucket</a>
				<a class="permalink" href="index.html?m=all#sendAndResetBucket">&#xb6;</a>
			</h2>
			<pre>func sendAndResetBucket(bucket *[]<a href="#">int64</a>, ws *<a href="#">websocket</a>.<a href="#n">Conn</a>, timeNow *<a href="#">int64</a>)</pre>
			<p>
sendAndResetBucket sends the bucket array out on the websocket connection.
After sending the bucket onto the websocket, it sets all the element in the buffer
to zero, and sets the timeNow the last recorded time in analysis.
</p>

			
			

		
			
			
			<h2 id="serverMain">func <a href="#">serverMain</a>
				<a class="permalink" href="index.html?m=all#serverMain">&#xb6;</a>
			</h2>
			<pre>func serverMain(registerNewClientCh chan&lt;- splitterRequest, deleteClientCh chan&lt;- splitterRequest)</pre>
			<p>
serverMain is the entry point for the websocket server. Takes as input a channel with timestamp data from the
analysis module, two splitterRequest channels registering and deleting itself
</p>

			
			

		
			
			
			<h2 id="splitterMain">func <a href="#">splitterMain</a>
				<a class="permalink" href="index.html?m=all#splitterMain">&#xb6;</a>
			</h2>
			<pre>func splitterMain(timestampdataCh &lt;-chan []<a href="#">int64</a>, registerNewClientCh &lt;-chan splitterRequest, deleteClientCh &lt;-chan splitterRequest)</pre>
			<p>
splitterMain is a PUBSUB implementation, taking the data from timestampdataCh and broadcasting it to all subscribers. In order
to register as a subscriber, you must register yourself by sending a request on the registerNewClientCh. When you do no longer wish to
subscribe, you must delete yourself by sending a request on the deleteClientCh.
</p>

			
			

		
			
			
			<h2 id="stimulateServer">func <a href="#">stimulateServer</a>
				<a class="permalink" href="index.html?m=all#stimulateServer">&#xb6;</a>
			</h2>
			<pre>func stimulateServer(rw <a href="#">http</a>.<a href="#">ResponseWriter</a>, req *<a href="#">http</a>.<a href="#">Request</a>)</pre>
			<p>
stimulateServer is the handler for HTTP POST requests to stimulate the MEA server. Verifies that the incoming POST request
is valid, and the json payload is valid, before sending it to the MEA server.
</p>
<p>
Parts of this code is inspired by
<a href="https://stackoverflow.com/questions/15672556/handling-json-post-request-in-go">https://stackoverflow.com/questions/15672556/handling-json-post-request-in-go</a>
</p>

			
			

		
		
			
			
			<h2 id="splitterRequest">type <a href="#">splitterRequest</a>
				<a class="permalink" href="index.html?m=all#splitterRequest">&#xb6;</a>
			</h2>
			<p>
splitterRequest defines a request to join the PUBSUB splitterMain. ID
</p>

			<pre>type splitterRequest struct {
<span id="splitterRequest.ID"></span>    ID     uuid.<a href="index.html?m=all#UUID">UUID</a>    <span class="comment">// A unique ID which no other subscriber has yet acquired</span>
<span id="splitterRequest.DataCh"></span>    DataCh chan []<a href="#">int64</a> <span class="comment">// A channel you wish to receive the subscriber data.</span>
}</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="stimulateRequest">type <a href="#">stimulateRequest</a>
				<a class="permalink" href="index.html?m=all#stimulateRequest">&#xb6;</a>
			</h2>
			<p>
stimulateRequest represents the JSON message in the stimulate POST request. See stimulateServer
</p>

			<pre>type stimulateRequest struct {
<span id="stimulateRequest.Frequency"></span>    Frequency <a href="#int">int</a> `json:&#34;frequency&#34;&#34;`
<span id="stimulateRequest.Duration"></span>    Duration  <a href="#">int</a> `json:&#34;duration&#34;&#34;`
<span id="stimulateRequest.Channel"></span>    Channel   <a href="#">int</a> `json:&#34;channel&#34;&#34;`
}</pre>

			

			

			
			
			

			

			
		
	

	







<div id="footer">
Build version go1.10.1.<br>
Except as <a href="https://developers.google.com/site-policies#restrictions">noted</a>,
the content of this page is licensed under the
Creative Commons Attribution 3.0 License,
and code is licensed under a <a href="#">BSD license</a>.<br>
<a href="#">Terms of Service</a> |
<a href="http://www.google.com/intl/en/policies/privacy/">Privacy Policy</a>
</div>

</div><!-- .container -->
</div><!-- #page -->
</body>
</html>

